# マウス操作を有効にする
set -g mouse on
# 履歴の保存行数を10000行に設定
set -g history-limit 10000
# ウィンドウのインデックスを1から開始する（デフォルトは0）
set -g base-index 1
# ウィンドウを閉じた際にインデックスを再計算して詰める
set -g renumber-windows on
# ステータスバーの更新間隔を5秒にする
set -g status-interval 5

# マウスホイールでスクロール
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# デフォルトターミナルを設定（tmux 内部で使用される TERM 値）
# screen-256color を使用（広く互換性があり、ほぼ全ての環境で terminfo が存在する）
set -g default-terminal "screen-256color"

# フォーカスイベントを無効化（エスケープシーケンスが漏れる原因となる可能性がある）
set -g focus-events off

# true color (24-bit color) サポートを有効化
# terminal-overrides を使用してターミナルエミュレータの機能を設定
# terminal-features は使用しない（ターミナルへの問い合わせが発生し、エスケープシーケンスが漏れる可能性がある）
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",xterm*:Tc"

# デフォルトシェルを bash に設定する
set -g default-shell /bin/bash

# クライアント側の PATH を tmux サーバに同期する
# これにより、クライアントが tmux セッションにアタッチする際に最新の PATH が使用される
set -ga update-environment "PATH"

# rキーで設定ファイルをリロードする
bind r source-file ~/.tmux.conf \; display-message "Reloaded tmux.conf"

# コピーモードのキー操作をvi風にする
setw -g mode-keys vi
# エスケープキーの入力待ち時間を10ミリ秒にする（Vimなどでの操作性向上）
set -sg escape-time 10

# powerline の設定を条件付きで読み込む
# powerline が存在しない環境ではエラーを抑制
if-shell "test -f /usr/share/powerline/bindings/tmux/powerline.conf" \
  "run-shell 'powerline-daemon -q'; source /usr/share/powerline/bindings/tmux/powerline.conf"
