#!/usr/bin/env bash
set -euo pipefail

# chezmoi のソースディレクトリにある暗号化された秘密鍵 (key.txt.age) を
# ~/.config/chezmoi/key.txt に復号して配置するスクリプト。
# このファイルが存在する場合、chezmoi apply 時に自動的に実行される。

src="{{ .chezmoi.sourceDir }}/key.txt.age"
dest="$HOME/.config/chezmoi/key.txt"

if [[ -f "$src" ]]; then
  mkdir -p "$(dirname "$dest")"
  chezmoi decrypt --output "$dest" "$src"
  chmod 600 "$dest"
fi
