## 目的

Claude Code の作業方針と、このリポジトリ固有のルールを示します。

## 判断記録のルール

1. 判断内容の要約
2. 検討した代替案
3. 採用しなかった案とその理由
4. 前提条件・仮定・不確実性
5. 他エージェントによるレビュー可否

前提・仮定・不確実性を明示し、仮定を事実のように扱わない。

## プロジェクト概要

- 目的: chezmoi で dotfiles と AI エージェント設定を管理する。
- 主な機能: シェル設定、tmux 設定、通知設定、エージェント設定のテンプレート化。

## 重要ルール

- 会話は日本語で行う。
- コード内コメントは日本語で記載する。
- エラーメッセージは英語で記載する。
- 日本語と英数字の間には半角スペースを挿入する。
- コミットメッセージは Conventional Commits に従う（description は日本語）。

## 環境のルール

- ブランチ名は Conventional Branch に従う。
- GitHub リポジトリ調査が必要な場合はテンポラリディレクトリに clone して行う。
- Renovate が作成した既存 PR には追加コミットしない。

## Git Worktree

- 使う場合は `.bare/<branch>` 構成で作成する。

## コード改修時のルール

- 既存のエラーメッセージが絵文字付きなら全体で統一する。
- TypeScript の `skipLibCheck` での回避は禁止。
- 関数・インターフェースの docstring は日本語で記載・更新する。

## 相談ルール

- Codex CLI: 実装レビュー、局所設計、整合性確認。
- Gemini CLI: 外部仕様や最新情報の確認。
- 指摘は黙殺せず、受容か却下理由を明示する。

## 開発コマンド

- `package.json` は存在しないため該当コマンドはない。
- 必要に応じて Docker 上で `chezmoi apply` を実行する。

## アーキテクチャと主要ファイル

- `home/`: chezmoi のソース。
- `home/dot_*`: 実際の dotfiles を `dot_` で表現。
- `home/dot_*/*.tmpl`: テンプレートファイル。
- `home/dot_*/*.d`: 追加設定の分割配置。

## 実装パターン

推奨:
- シェル設定は `.d` ディレクトリに分割する。
- 秘密情報は `~/.env` または `~/.gitconfig.local` で管理する（chezmoi 管理外）。

非推奨:
- 秘密情報の平文コミット。
- 一括で巨大な設定ファイルに追記する。

## テスト

- 自動テストはない。
- 変更後は Docker 上で `chezmoi apply` を実行して結果を確認する。

## ドキュメント更新ルール

- `README.md`
- `CLAUDE.md` / `AGENTS.md` / `GEMINI.md` / `.github/copilot-instructions.md`

## 作業チェックリスト

### 新規改修時

1. プロジェクトを理解する
2. 作業ブランチが適切であることを確認する
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する
4. 不要ブランチが削除済みであることを確認する
5. 必要な依存関係がある場合はインストールする

### コミット・プッシュ前

1. Conventional Commits に従っていることを確認する
2. センシティブな情報が含まれていないことを確認する
3. Lint / Format エラーがないことを確認する
4. 動作確認を行う

### PR 作成前

1. PR 作成の依頼があることを確認する
2. センシティブな情報が含まれていないことを確認する
3. コンフリクトの恐れがないことを確認する

### PR 作成後

1. コンフリクトがないことを確認する
2. PR 本文が最新状態のみを網羅していることを確認する
3. `gh pr checks <PR ID> --watch` で CI を確認する
4. Copilot レビューに対応し、コメントに返信する
5. Codex のコードレビューを実施し、指摘対応を行う
6. PR 本文の崩れがないことを確認する

## リポジトリ固有

- Git 設定は `~/.gitconfig.local` で管理（chezmoi 管理外）。
- 通知系の環境変数は `~/.env` で管理（chezmoi 管理外）。
- `.env.example` と `.gitconfig.local.example` をサンプルとして提供。
- wakatime は別途管理するため、dotfiles での暗号化管理は行わない。
