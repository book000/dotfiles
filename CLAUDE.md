# Claude Code 作業方針

## 目的
Claude Code の作業方針と、このリポジトリ固有のルールを示します。

## 判断記録のルール
1. 判断内容の要約を記載する
2. 検討した代替案を列挙する
3. 採用しなかった案とその理由を明記する
4. 前提条件・仮定・不確実性を明示する
5. 他エージェントによるレビュー可否を示す

前提・仮定・不確実性を明示し、仮定を事実のように扱わない。

## プロジェクト概要
- 目的: chezmoi で dotfiles と AI エージェント設定を管理する。
- 主な機能: シェル設定（Bash/Zsh）、tmux 設定、通知設定、エージェント設定のテンプレート化。

## 重要ルール
- 会話は日本語で行う。
- コミットメッセージは Conventional Commits に従う（description は日本語）。
- コード内コメントは日本語で記載する。
- エラーメッセージは英語で記載する。
- 日本語と英数字の間には半角スペースを挿入する。

## 環境のルール
- ブランチ命名は [Conventional Branch](https://conventional-branch.github.io) に従う（feat/..., fix/...）。
- GitHub リポジトリを調査する場合は、テンポラリディレクトリに clone して行う。
- Renovate が作成した既存のプルリクエストに対して、追加コミットや更新を行わない。

## Git Worktree
- Git Worktree を使用する場合、以下のディレクトリ構成とする。
  ```text
  .bare/
  <ブランチ名>/
  ```

## コード改修時のルール
- 既存のエラーメッセージで先頭に絵文字がある場合は、全体で絵文字入りのエラーメッセージに統一する。
- TypeScript を使用する場合、`skipLibCheck` によるエラー回避は禁止する。
- 関数やインターフェースには docstring (JSDoc 等) を日本語で記載・更新する。

## 相談ルール
- **Codex CLI**: 実装の詳細レビュー、局所的な設計、既存コードとの整合性確認に使用する。
- **Gemini CLI**: 外部ライブラリの仕様確認、最新情報の調査、広範なアーキテクチャの相談に使用する。
- 指摘に対しては、真摯に対応するか、対応しない場合はその理由を論理的に説明する。

## 開発コマンド
このプロジェクトには `package.json` は存在しません。
```bash
# 設定の適用（ドライラン）
chezmoi apply --dry-run

# 設定の適用
chezmoi apply

# 秘密情報の追加（暗号化）
chezmoi add --encrypt <file>
```

## アーキテクチャと主要ファイル
- `home/`: chezmoi のソース。各設定ファイルが `dot_` プレフィックスで配置されている。
- `home/dot_bashrc.d/`, `home/dot_zshrc.d/`: シェル設定の分割ディレクトリ。
- `home/dot_gemini/`, `home/dot_claude/`: 各 AI エージェント向けの汎用設定。
- `.chezmoi.toml.tmpl`: chezmoi 自体の設定テンプレート。

## 実装パターン
- **推奨**: 秘密情報は `age` で暗号化し、ソースには `encrypted_` プレフィックスを付けて管理する。
- **推奨**: 大規模なシェル設定は `.d` ディレクトリ配下に機能単位で分割して配置する。
- **非推奨**: 秘密情報（API キー等）を平文でコミットする。

## テスト
- 自動テストは存在しない。
- 変更後は `chezmoi apply --dry-run` を実行し、生成されるファイルの内容が期待通りであることを目視で確認する。

## ドキュメント更新ルール
- `README.md`: セットアップや暗号化の手順に変更があった場合に更新する。
- プロンプトファイル: 方針やルールに変更があった場合に、`CLAUDE.md`, `AGENTS.md`, `GEMINI.md`, `.github/copilot-instructions.md` を同期して更新する。

## 作業チェックリスト

### 新規改修時
1. プロジェクトの構造と `chezmoi` の利用方法を理解する。
2. 作業ブランチが適切であることを確認する。
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する。
4. PR がクローズされた不要ブランチが削除済みであることを確認する。

### コミット・プッシュ前
1. Conventional Commits に従っていることを確認する。
2. センシティブな情報（API キー等）が含まれていないことを確認する。
3. 動作確認（`chezmoi apply --dry-run` 等）を行う。

### PR 作成前
1. ユーザーから PR 作成の依頼があることを確認する。
2. センシティブな情報が含まれていないことを再確認する。
3. コンフリクトの恐れがないことを確認する。

### PR 作成後
1. コンフリクトが発生していないことを確認する。
2. PR 本文が最新の状態を網羅し、日本語で分かりやすく記載されていることを確認する。
3. CI が存在する場合はその結果を確認する。
4. GitHub Copilot や Codex によるレビュー指摘に対応する。

## リポジトリ固有
- `home/` 配下のファイルは、`chezmoi apply` によってユーザーのホームディレクトリに展開される。
- `.env` ファイルは直接管理せず、`dot_env.tmpl` から生成される仕組みを維持する。